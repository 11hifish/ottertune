{% extends "base.html" %}

{% block body %}

<!--[if lt IE 9]><script language="javascript" type="text/javascript" src="{{ STATIC_URL }}js/jqplot/excanvas.js"></script><![endif]-->
<script language="javascript" type="text/javascript" src="{{ STATIC_URL }}js/jqplot/jquery.jqplot.min.js"></script>
<link rel="stylesheet" type="text/css" href="{{ STATIC_URL }}js/jqplot/jquery.jqplot.min.css" />

<div id="benchmark_info" class="container">
<table class="table table-striped table-bordered table-condensed table-hover">
    <caption><h4>Benchmark Configuration (<a href="/edit_benchmark_conf/?id={{ benchmark.pk }}">edit</a>)</h4></caption>
    <tbody>
    <tr>
        <td><div class="text-right">Name:</div></td>
        <td>{{ benchmark.name }}</td>
    </tr>
    <tr>
        <td><div class="text-top text-right">Description:</div></td>
        <td>{{ benchmark.description|safe|linebreaks }}</td>
    </tr>
    <tr>
        <td><div class="text-right">Type:</div></td>
        <td>{{ benchmark.benchmark_type }}</td>
    </tr>
    <tr>
        <td><div class="text-right">Isolation Level:</div></td>
        <td>{{ benchmark.isolation }}</td>
    </tr>
    <tr>
        <td><div class="text-right">Scale Factor:</div></td>
        <td>{{ benchmark.scalefactor }}</td>
    </tr>
    <tr>
        <td><div class="text-right"># of Terminals:</div></td>
        <td>{{ benchmark.terminals }}</td>
    </tr>
    <tr>
        <td><div class="text-right">Creation time:</div></td>
        <td>{{ benchmark.creation_time }}</td>
    </tr>
    </tbody>
</table>
</div>

<hr>

<div class="container">
<div class="row">

<div id="sidebar" class="col-md-3">
<div id="dbs">
    <div><h4>DBMS</h4></div>
    <div class="boxbody checkbox">
        <ul>
        {% for db_name, confs in dbs.items %}
        <li><label><input type="checkbox" name="db" value="{{ db_name }}"/> {{ db_name }}</label>
            <ul>
            {% for conf_name, data in confs.items %}
            <li><label><input type="checkbox" name="db_{{ db_name }}" value="{{ data.0.pk }}"/>{{ conf_name }}</label></li>
            {% endfor %}
            </ul>
        </li>
        {% endfor %}
        </ul>
    </div>
</div>
<div id="metric">
    <div><h4>Plot Metrics</h4></div>
    <div class="checkbox boxbody">
        <ul>
        {% for metric in metrics %}
        <li><label><input type="checkbox" name="metric" value="{{ metric.field }}" /> {{ metric.print }}</label></li>
        {% endfor %}
        </ul>
    </div>
</div>
</div>

<div class="col-md-9">
<!--<div id="configbar" class="row">-->
    <!--<div class="col-md-10">-->
    <!--Show the last-->
    <!--<select id="revisions" class="selectpicker">-->
        <!--{% for rev in lastrevisions %}-->
        <!--<option value="{{ rev }}">{{ rev }}</option>-->
        <!--{% endfor %}-->
    <!--</select> results-->
    <!--</div>-->
    <!--<div class="col-md-2 checkbox">-->
        <!--<label><input id="equidistant" class="option" name="equidistant" type="checkbox"/> Equidistant</label>-->
    <!--</div>-->
<!--</div>-->

<div id="content">
    <div id="plotgrid" class="plotcontainer"></div>
    <div id="chartpseudotooltip"></div>
    <!--<div id="parameters" class="container">-->
        <!--<p>{{ benchmark.configuration }}</p>-->
    <!--</div>-->
</div>

</div>

</div>

<div class="container">
    <h3>Configuration:</h3>
    <div id="conf_xml">
    </div>
</div>
</div>
<script type="text/javascript" src="{{ STATIC_URL }}js/jqplot/jqplot.cursor.min.js"></script>
<script type="text/javascript" src="{{ STATIC_URL }}js/jqplot/jqplot.highlighter.min.js"></script>
<script type="text/javascript" src="{{ STATIC_URL }}js/jqplot/jqplot.dateAxisRenderer.min.js"></script>
<script type="text/javascript" src="{{ STATIC_URL }}js/jqplot/jqplot.categoryAxisRenderer.min.js"></script>
<script type="text/javascript" src="{{ STATIC_URL }}js/jqplot/jqplot.canvasTextRenderer.min.js"></script>
<script type="text/javascript" src="{{ STATIC_URL }}js/jqplot/jqplot.canvasAxisLabelRenderer.min.js"></script>
<script type="text/javascript" src="{{ STATIC_URL }}js/jqplot/jqplot.canvasAxisTickRenderer.min.js"></script>
<script type="text/javascript" src="{{ STATIC_URL }}js/jqplot/jqplot.barRenderer.min.js"></script>

<script type="text/javascript" src="{{ STATIC_URL }}js/benchmark_bar.js"></script>
<script language="javascript">
$(function() {
    $('.selectpicker').selectpicker();
    BenchmarkBar.init({
        benchmark: {{ benchmark.pk }},
        // proj: {{ project.pk }},
        // dbs: [{% for db in db_types %}"{{ db }}", {% endfor %}],
        // revisions: {{ defaultlast }},
        // benchmark: "{{ defaultbenchmark }}",
        // benchmarks: { {% for ben, conf in benchmarks.items %} "{{ ben }}": "{{ conf.pk }}", {% endfor %} },
        // equidistant: "{{ defaultequid }}",
        db_confs: [{% for db in default_dbconf %}"{{ db }}", {% endfor %}],
        metrics: [{% for metric in default_metrics %}"{{ metric }}", {% endfor %}],
    });

    xml_raw = '{{ benchmark.configuration|safe }}';
    xml_formatted = formatXml(xml_raw);
    xml_escaped = xml_formatted.replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;').replace(/ /g, '&nbsp;').replace(/\n/g,'<br />');
    $("#conf_xml").html(xml_escaped);
});

function formatXml(xml) {
    var formatted = '';
    var reg = /(>)(<)(\/*)/g;
    xml = xml.replace(reg, '$1\r\n$2$3');
    var pad = 0;
    jQuery.each(xml.split('\r\n'), function(index, node) {
        var indent = 0;
        if (node.match( /.+<\/\w[^>]*>$/ )) {
            indent = 0;
        } else if (node.match( /^<\/\w/ )) {
            if (pad != 0) {
                pad -= 1;
            }
        } else if (node.match( /^<\w[^>]*[^\/]>.*$/ )) {
            indent = 1;
        } else {
            indent = 0;
        }

        var padding = '';
        for (var i = 0; i < pad; i++) {
            padding += '  ';
        }

        formatted += padding + node + '\r\n';
        pad += indent;
    });

    return formatted;
}
</script>
{% endblock body %}
